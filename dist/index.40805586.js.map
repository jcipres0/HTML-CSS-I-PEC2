{"mappings":"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","sources":["src/mapkick.js"],"sourcesContent":["/*\r\n * Mapkick.js v0.2.6\r\n * Create beautiful, interactive maps with one line of JavaScript\r\n * https://github.com/ankane/mapkick.js\r\n * MIT License\r\n */\r\n\r\n(function (global, factory) {\r\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\r\n  typeof define === 'function' && define.amd ? define(factory) :\r\n  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, global.Mapkick = factory());\r\n})(this, (function () { 'use strict';\r\n\r\n  function getElement(element) {\r\n    if (typeof element === \"string\") {\r\n      var elementId = element;\r\n      element = document.getElementById(element);\r\n      if (!element) {\r\n        throw new Error(\"No element with id \" + elementId)\r\n      }\r\n    }\r\n    return element\r\n  }\r\n\r\n  // check for hex or named color\r\n  function validateColor(color) {\r\n    if (!/^#([0-9a-f]{3}){1,2}$/i.test(color) && !/^[a-z]+$/i.test(color)) {\r\n      throw new Error(\"Invalid color\")\r\n    }\r\n  }\r\n\r\n  function createMarkerImage(library, color) {\r\n    // set height to center vertically\r\n    var height = 41;\r\n    var width = 27;\r\n    var scale = 2;\r\n\r\n    // get marker svg\r\n    var svg = (new library.Marker())._element.querySelector(\"svg\");\r\n\r\n    // make displayable and center vertically\r\n    svg.removeAttribute(\"display\");\r\n    svg.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\r\n    svg.setAttribute(\"height\", height);\r\n    svg.setAttribute(\"width\", width);\r\n    svg.setAttribute(\"viewBox\", (\"0 0 \" + width + \" \" + height));\r\n\r\n    validateColor(color);\r\n\r\n    // set color\r\n    svg.querySelector(\"*[fill='#3FB1CE']\").setAttribute(\"fill\", color);\r\n\r\n    // add border to inner circle\r\n    var circles = svg.querySelectorAll(\"circle\");\r\n    var circle = circles[circles.length - 1];\r\n    if (circles.length == 1) {\r\n      // need to insert new circle for mapbox-gl v2\r\n      var c = circle.cloneNode();\r\n      c.setAttribute(\"fill\", \"#000000\");\r\n      c.setAttribute(\"opacity\", 0.25);\r\n      circle.parentNode.insertBefore(c, circle);\r\n    }\r\n    circle.setAttribute(\"r\", 4.5);\r\n\r\n    // create image\r\n    var image = new Image(width * scale, height * scale);\r\n    image.src = \"data:image/svg+xml;utf8,\" + (encodeURIComponent(svg.outerHTML));\r\n    return image\r\n  }\r\n\r\n  var maps = {};\r\n\r\n  var BaseMap = function BaseMap(element, data, options, mapType) {\r\n    var this$1$1 = this;\r\n\r\n    if (!Mapkick.library && typeof window !== \"undefined\") {\r\n      Mapkick.library = window.mapboxgl || window.maplibregl || null;\r\n    }\r\n\r\n    var library = Mapkick.library;\r\n    if (!library) {\r\n      throw new Error(\"No mapping library found\")\r\n    }\r\n\r\n    var map;\r\n    var trails = {};\r\n    var groupedData = {};\r\n    var timestamps = [];\r\n    var timeIndex = 0;\r\n\r\n    element = getElement(element);\r\n\r\n    if (element.id) {\r\n      maps[element.id] = this;\r\n    }\r\n\r\n    function getJSON(element, url, success) {\r\n      var xhr = new XMLHttpRequest();\r\n      xhr.open(\"GET\", url, true);\r\n      xhr.setRequestHeader(\"Content-Type\", \"application/json\");\r\n      xhr.onload = function () {\r\n        if (xhr.status === 200) {\r\n          success(JSON.parse(xhr.responseText));\r\n        } else {\r\n          showError(element, xhr.statusText);\r\n        }\r\n      };\r\n      xhr.send();\r\n    }\r\n\r\n    function onMapLoad(callback) {\r\n      if (map.loaded()) {\r\n        callback();\r\n      } else {\r\n        map.on(\"load\", callback);\r\n      }\r\n    }\r\n\r\n    function toTimestamp(ts) {\r\n      if (typeof ts === \"number\") {\r\n        return ts\r\n      } else {\r\n        return (new Date(ts)).getTime() / 1000\r\n      }\r\n    }\r\n\r\n    function generateReplayMap(element, data, options) {\r\n      // group data\r\n      for (var i = 0; i < data.length; i++) {\r\n        var row = data[i];\r\n        var ts = toTimestamp(row.time);\r\n        if (ts) {\r\n          if (!groupedData[ts]) {\r\n            groupedData[ts] = [];\r\n          }\r\n          groupedData[ts].push(row);\r\n          bounds.extend(rowCoordinates(row));\r\n        }\r\n      }\r\n\r\n      for (var i$1 in groupedData) {\r\n        if (Object.prototype.hasOwnProperty.call(groupedData, i$1)) {\r\n          timestamps.push(parseInt(i$1));\r\n        }\r\n      }\r\n      timestamps.sort();\r\n\r\n      // create map\r\n      generateMap(element, groupedData[timestamps[timeIndex]], options);\r\n\r\n      onMapLoad(function () {\r\n        setTimeout(function () {\r\n          nextFrame(element, options);\r\n        }, 100);\r\n      });\r\n    }\r\n\r\n    function nextFrame(element, options) {\r\n      timeIndex++;\r\n\r\n      updateMap(element, groupedData[timestamps[timeIndex]], options);\r\n\r\n      if (timeIndex < timestamps.length - 1) {\r\n        setTimeout(function () {\r\n          nextFrame(element, options);\r\n        }, 100);\r\n      }\r\n    }\r\n\r\n    function showError(element, message) {\r\n      element.textContent = message;\r\n    }\r\n\r\n    function errorCatcher(element, data, options, callback) {\r\n      try {\r\n        callback(element, data, options);\r\n      } catch (err) {\r\n        showError(element, err.message);\r\n        throw err\r\n      }\r\n    }\r\n\r\n    function fetchData(element, data, options, callback) {\r\n      if (typeof data === \"string\") {\r\n        getJSON(element, data, function (newData) {\r\n          errorCatcher(element, newData, options, callback);\r\n        });\r\n      } else if (typeof data === \"function\") {\r\n        data(function (newData) {\r\n          errorCatcher(element, newData, options, callback);\r\n        }, function (message) {\r\n          showError(element, message);\r\n        });\r\n      } else {\r\n        errorCatcher(element, data, options, callback);\r\n      }\r\n    }\r\n\r\n    function updateMap(element, data, options) {\r\n      onLayersReady(function () {\r\n        if (options.trail) {\r\n          recordTrails(data, options.trail);\r\n          map.getSource(\"trails\").setData(generateTrailsGeoJSON(data));\r\n        }\r\n        map.getSource(\"objects\").setData(generateGeoJSON(data, options));\r\n      });\r\n    }\r\n\r\n    // use Map instead of object for security\r\n    var markerIds = new window.Map();\r\n\r\n    function generateGeoJSON(data, options) {\r\n      var geojson = {\r\n        type: \"FeatureCollection\",\r\n        features: []\r\n      };\r\n\r\n      for (var i = 0; i < data.length; i++) {\r\n        var row = data[i];\r\n        var properties = Object.assign({}, row);\r\n        var geometry = (void 0);\r\n\r\n        if (mapType === \"point\") {\r\n          if (!properties.icon) {\r\n            properties.icon = options.defaultIcon || \"mapkick\";\r\n          }\r\n          properties.mapkickIconSize = properties.icon === \"mapkick\" ? 0.5 : 1;\r\n          properties.mapkickIconAnchor = properties.icon === \"mapkick\" ? \"bottom\" : \"center\";\r\n          properties.mapkickIconOffset = properties.icon === \"mapkick\" ? [0, 10] : [0, 0];\r\n\r\n          if (properties.icon === \"mapkick\") {\r\n            var color = properties.color || markerOptions.color || \"#f84d4d\";\r\n\r\n            var markerId = markerIds.get(color);\r\n            if (markerId === undefined) {\r\n              markerId = markerIds.size;\r\n              validateColor(color);\r\n              markerIds.set(color, markerId);\r\n            }\r\n\r\n            properties.icon = \"mapkick-\" + markerId;\r\n          }\r\n\r\n          var coordinates = rowCoordinates(row);\r\n\r\n          if (!coordinates[1]) {\r\n            throw new Error((\"missing latitude (index: \" + i + \")\"))\r\n          }\r\n\r\n          if (!coordinates[0]) {\r\n            throw new Error((\"missing longitude (index: \" + i + \")\"))\r\n          }\r\n\r\n          geometry = {\r\n            type: \"Point\",\r\n            coordinates: coordinates\r\n          };\r\n        } else {\r\n          geometry = row.geometry;\r\n\r\n          if (!geometry) {\r\n            throw new Error((\"missing geometry (index: \" + i + \")\"))\r\n          }\r\n\r\n          delete properties.geometry;\r\n\r\n          properties.mapkickColor = properties.color || markerOptions.color || \"#0090ff\";\r\n\r\n        }\r\n\r\n        geojson.features.push({\r\n          type: \"Feature\",\r\n          id: i,\r\n          geometry: geometry,\r\n          properties: properties\r\n        });\r\n      }\r\n\r\n      return geojson\r\n    }\r\n\r\n    function rowCoordinates(row) {\r\n      return [row.longitude || row.lng || row.lon, row.latitude || row.lat]\r\n    }\r\n\r\n    function getTrailId(row) {\r\n      return row.id\r\n    }\r\n\r\n    function recordTrails(data, trailOptions) {\r\n      for (var i = 0; i < data.length; i++) {\r\n        var row = data[i];\r\n        var trailId = getTrailId(row);\r\n        if (!trails[trailId]) {\r\n          trails[trailId] = [];\r\n        }\r\n        trails[trailId].push(rowCoordinates(row));\r\n        if (trailOptions && trailOptions.len && trails[trailId].length > trailOptions.len) {\r\n          trails[trailId].shift();\r\n        }\r\n      }\r\n    }\r\n\r\n    function generateTrailsGeoJSON(data) {\r\n      var geojson = {\r\n        type: \"FeatureCollection\",\r\n        features: []\r\n      };\r\n\r\n      for (var i = 0; i < data.length; i++) {\r\n        var row = data[i];\r\n        geojson.features.push({\r\n          type: \"Feature\",\r\n          geometry: {\r\n            type: \"LineString\",\r\n            coordinates: trails[getTrailId(row)]\r\n          }\r\n        });\r\n      }\r\n\r\n      return geojson\r\n    }\r\n\r\n    function generateLabelGeoJSON(data) {\r\n      var geojson = {\r\n        type: \"FeatureCollection\",\r\n        features: []\r\n      };\r\n\r\n      for (var i = 0; i < data.features.length; i++) {\r\n        var feature = data.features[i];\r\n        var coordinates = (void 0);\r\n\r\n        // use center for now\r\n        var bounds = new library.LngLatBounds();\r\n        extendBounds(bounds, feature.geometry);\r\n        if (!bounds.isEmpty()) {\r\n          var center = bounds.getCenter();\r\n          coordinates = [center.lng, center.lat];\r\n        }\r\n\r\n        if (coordinates) {\r\n          geojson.features.push({\r\n            type: \"Feature\",\r\n            id: i,\r\n            geometry: {\r\n              type: \"Point\",\r\n              coordinates: coordinates\r\n            },\r\n            properties: feature.properties\r\n          });\r\n        }\r\n      }\r\n\r\n      return geojson\r\n    }\r\n\r\n    function layerBeforeFill(map) {\r\n      // place below labels\r\n      var layers = map.getStyle().layers;\r\n      var beforeId;\r\n      for (var i = layers.length - 1; i >= 0; i--) {\r\n        var layer = layers[i];\r\n        // TODO improve\r\n        if (!(layer.metadata && layer.metadata[\"mapbox:featureComponent\"] === \"place-labels\")) {\r\n          break\r\n        }\r\n        beforeId = layer.id;\r\n      }\r\n      return beforeId\r\n    }\r\n\r\n    function addLayer(name, geojson) {\r\n      var centersById = {};\r\n\r\n      map.addSource(name, {\r\n        type: \"geojson\",\r\n        data: geojson\r\n      });\r\n\r\n      if (mapType === \"point\") {\r\n        // use a symbol layer for markers for performance\r\n        // https://docs.mapbox.com/help/getting-started/add-markers/#approach-1-adding-markers-inside-a-map\r\n        // use separate layers to prevent labels from overlapping markers\r\n        map.addLayer({\r\n          id: (name + \"-text\"),\r\n          source: name,\r\n          type: \"symbol\",\r\n          layout: {\r\n            \"text-field\": \"{label}\",\r\n            \"text-size\": 11,\r\n            \"text-anchor\": \"top\",\r\n            \"text-offset\": [0, 1]\r\n          },\r\n          paint: {\r\n            \"text-halo-color\": \"rgba(255, 255, 255, 1)\",\r\n            \"text-halo-width\": 1\r\n          }\r\n        });\r\n        map.addLayer({\r\n          id: name,\r\n          source: name,\r\n          type: \"symbol\",\r\n          layout: {\r\n            \"icon-image\": \"{icon}-15\",\r\n            \"icon-allow-overlap\": true,\r\n            \"icon-size\": {type: \"identity\", property: \"mapkickIconSize\"},\r\n            \"icon-anchor\": {type: \"identity\", property: \"mapkickIconAnchor\"},\r\n            \"icon-offset\": {type: \"identity\", property: \"mapkickIconOffset\"}\r\n          }\r\n        });\r\n      } else {\r\n        var beforeId = layerBeforeFill(map);\r\n\r\n        var outlineId = name + \"-outline\";\r\n        map.addLayer({\r\n          id: outlineId,\r\n          source: name,\r\n          type: \"line\",\r\n          paint: {\r\n            \"line-color\": {type: \"identity\", property: \"mapkickColor\"},\r\n            \"line-opacity\": 0.7,\r\n            \"line-width\": 1\r\n          }\r\n        }, beforeId);\r\n\r\n        map.addLayer({\r\n          id: name,\r\n          source: name,\r\n          type: \"fill\",\r\n          paint: {\r\n            \"fill-color\": {type: \"identity\", property: \"mapkickColor\"},\r\n            \"fill-opacity\": 0.3\r\n          }\r\n        }, outlineId);\r\n\r\n        var labelName = name + \"-text\";\r\n        var labelData = generateLabelGeoJSON(geojson);\r\n\r\n        for (var i = 0; i < labelData.features.length; i++) {\r\n          var feature = labelData.features[i];\r\n          centersById[feature.id] = feature.geometry.coordinates;\r\n        }\r\n\r\n        map.addSource(labelName, {\r\n          type: \"geojson\",\r\n          data: labelData\r\n        });\r\n\r\n        map.addLayer({\r\n          id: (name + \"-text\"),\r\n          source: labelName,\r\n          type: \"symbol\",\r\n          layout: {\r\n            \"text-field\": \"{label}\",\r\n            \"text-size\": 11\r\n          },\r\n          paint: {\r\n            \"text-halo-color\": \"rgba(255, 255, 255, 1)\",\r\n            \"text-halo-width\": 1\r\n          }\r\n        });\r\n      }\r\n\r\n      var hover = !(\"hover\" in tooltipOptions) || tooltipOptions.hover;\r\n\r\n      var popupOptions = {\r\n        closeButton: false,\r\n        closeOnClick: false\r\n      };\r\n      if (!hover) {\r\n        popupOptions.anchor = \"bottom\";\r\n      }\r\n\r\n      // create a popup\r\n      var popup = new library.Popup(popupOptions);\r\n\r\n      // ensure tooltip is visible\r\n      var panMap = function (map, popup) {\r\n        var style = window.getComputedStyle(popup.getElement());\r\n        var matrix = new DOMMatrixReadOnly(style.transform);\r\n        var padding = 5;\r\n        var extra = 5;\r\n        var top = matrix.m42;\r\n        var left = matrix.m41;\r\n\r\n        // TODO add right and bottom\r\n        if (top < padding || left < padding) {\r\n          map.panBy([Math.min(left - padding - extra, 0), Math.min(top - padding - extra, 0)]);\r\n        }\r\n      };\r\n\r\n      var showPopup = function (e) {\r\n        var feature = selectedFeature(e);\r\n        var tooltip = feature.properties.tooltip;\r\n\r\n        if (!tooltip) {\r\n          return\r\n        }\r\n\r\n        if (mapType === \"point\" && feature.properties.icon.startsWith(\"mapkick-\")) {\r\n          popup.options.offset = {\r\n            \"top\": [0, 14],\r\n            \"top-left\": [0, 14],\r\n            \"top-right\": [0, 14],\r\n            \"bottom\": [0, -44],\r\n            \"bottom-left\": [0, -44],\r\n            \"bottom-right\": [0, -44],\r\n            \"left\": [14, 0],\r\n            \"right\": [-14, 0]\r\n          };\r\n        } else {\r\n          popup.options.offset = 14;\r\n        }\r\n\r\n        var coordinates;\r\n        if (mapType === \"point\") {\r\n          coordinates = feature.geometry.coordinates;\r\n        } else {\r\n          coordinates = centersById[feature.id];\r\n        }\r\n\r\n        // add the tooltip\r\n        popup.setLngLat(coordinates);\r\n        if (tooltipOptions.html) {\r\n          popup.setHTML(tooltip);\r\n        } else {\r\n          popup.setText(tooltip);\r\n        }\r\n        popup.addTo(map);\r\n\r\n        // fix blurriness for non-retina screens\r\n        // https://github.com/mapbox/mapbox-gl-js/pull/3258\r\n        if (popup._container.offsetWidth % 2 !== 0) {\r\n          popup._container.style.width = popup._container.offsetWidth + 1 + \"px\";\r\n        }\r\n\r\n        if (mapType !== \"area\") {\r\n          panMap(map, popup);\r\n        }\r\n      };\r\n\r\n      var getLatitude = function (feature) {\r\n        return feature.geometry.coordinates[1]\r\n      };\r\n\r\n      var selectedFeature = function (e) {\r\n        var features = e.features;\r\n        var selected = features[0];\r\n        for (var i = 1; i < features.length; i++) {\r\n          var feature = features[i];\r\n          // no need to handle ties since this is stable\r\n          if (getLatitude(feature) < getLatitude(selected)) {\r\n            selected = feature;\r\n          }\r\n        }\r\n        return selected\r\n      };\r\n\r\n      if (!hover) {\r\n        var currentPoint = null;\r\n\r\n        map.on(\"click\", name, function (e) {\r\n          var point = selectedFeature(e).id;\r\n          if (point !== currentPoint) {\r\n            showPopup(e);\r\n            currentPoint = point;\r\n            e.mapkickPopupOpened = true;\r\n          }\r\n        });\r\n\r\n        map.on(\"click\", function (e) {\r\n          if (!e.mapkickPopupOpened) {\r\n            popup.remove();\r\n            currentPoint = null;\r\n          }\r\n        });\r\n      }\r\n\r\n      map.on(\"mouseenter\", name, function (e) {\r\n        var tooltip = selectedFeature(e).properties.tooltip;\r\n\r\n        if (tooltip) {\r\n          map.getCanvas().style.cursor = \"pointer\";\r\n\r\n          if (hover) {\r\n            showPopup(e);\r\n          }\r\n        }\r\n      });\r\n\r\n      map.on(\"mouseleave\", name, function () {\r\n        map.getCanvas().style.cursor = \"\";\r\n\r\n        if (hover) {\r\n          popup.remove();\r\n        }\r\n      });\r\n    }\r\n\r\n    function extendBounds(bounds, geometry) {\r\n      if (geometry.type === \"Point\") {\r\n        bounds.extend(geometry.coordinates);\r\n      } else if (geometry.type === \"Polygon\") {\r\n        var coordinates = geometry.coordinates[0];\r\n        for (var j = 0; j < coordinates.length; j++) {\r\n          bounds.extend(coordinates[j]);\r\n        }\r\n      } else if (geometry.type === \"MultiPolygon\") {\r\n        var coordinates$1 = geometry.coordinates;\r\n        for (var j$1 = 0; j$1 < coordinates$1.length; j$1++) {\r\n          var polygon = coordinates$1[j$1][0];\r\n          for (var k = 0; k < polygon.length; k++) {\r\n            bounds.extend(polygon[k]);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    var generateMap = function (element, data, options) {\r\n      var geojson = generateGeoJSON(data, options);\r\n      options = options || {};\r\n\r\n      for (var i = 0; i < geojson.features.length; i++) {\r\n        extendBounds(bounds, geojson.features[i].geometry);\r\n      }\r\n\r\n      // remove any child elements\r\n      element.textContent = \"\";\r\n\r\n      var style = options.style;\r\n      if (!style) {\r\n        var isMapLibre = !(\"accessToken\" in library) || /^1\\.1[45]/.test(library.version);\r\n        if (isMapLibre) {\r\n          throw new Error(\"style required for MapLibre\")\r\n        } else {\r\n          style = \"mapbox://styles/mapbox/streets-v12\";\r\n        }\r\n      }\r\n\r\n      var zoom = options.zoom;\r\n      var center = options.center;\r\n      if (!center) {\r\n        if (!bounds.isEmpty()) {\r\n          center = bounds.getCenter();\r\n        } else {\r\n          center = [0, 0];\r\n          if (!zoom) {\r\n            zoom = 1;\r\n          }\r\n        }\r\n      }\r\n      if (!zoom) {\r\n        zoom = 15;\r\n      }\r\n\r\n      var mapOptions = {\r\n        container: element,\r\n        style: style,\r\n        dragRotate: false,\r\n        touchZoomRotate: false,\r\n        center: center,\r\n        zoom: zoom\r\n      };\r\n      if (!options.style) {\r\n        mapOptions.projection = \"mercator\";\r\n      }\r\n      if (options.accessToken) {\r\n        mapOptions.accessToken = options.accessToken;\r\n      }\r\n      if (options.library) {\r\n        Object.assign(mapOptions, options.library);\r\n      }\r\n      map = new library.Map(mapOptions);\r\n\r\n      if (options.controls) {\r\n        map.addControl(new library.NavigationControl({showCompass: false}));\r\n      }\r\n\r\n      if (!options.zoom) {\r\n        // hack to prevent error\r\n        if (!map.style.stylesheet) {\r\n          map.style.stylesheet = {};\r\n        }\r\n\r\n        // check zoom for hash library option\r\n        if (!bounds.isEmpty() && map.getZoom() === zoom) {\r\n          map.fitBounds(bounds, {padding: 40, animate: false, maxZoom: 15});\r\n        }\r\n      }\r\n\r\n      this$1$1.map = map;\r\n\r\n      onMapLoad(function () {\r\n        if (options.trail) {\r\n          recordTrails(data);\r\n\r\n          map.addSource(\"trails\", {\r\n            type: \"geojson\",\r\n            data: generateTrailsGeoJSON([])\r\n          });\r\n\r\n          map.addLayer({\r\n            id: \"trails\",\r\n            source: \"trails\",\r\n            type: \"line\",\r\n            layout: {\r\n              \"line-join\": \"round\",\r\n              \"line-cap\": \"round\"\r\n            },\r\n            paint: {\r\n              \"line-color\": \"#888\",\r\n              \"line-width\": 2\r\n            }\r\n          });\r\n        }\r\n\r\n        var outstanding = markerIds.size;\r\n\r\n        function checkReady() {\r\n          if (outstanding !== 0) {\r\n            outstanding--;\r\n            return\r\n          }\r\n\r\n          addLayer(\"objects\", geojson);\r\n\r\n          layersReady = true;\r\n          var cb;\r\n          while ((cb = layersReadyQueue.shift())) {\r\n            cb();\r\n          }\r\n        }\r\n\r\n        // load marker images\r\n        markerIds.forEach(function (id, color) {\r\n          var image = createMarkerImage(library, color);\r\n          image.addEventListener(\"load\", function () {\r\n            map.addImage((\"mapkick-\" + id + \"-15\"), image);\r\n            checkReady();\r\n          });\r\n        });\r\n\r\n        checkReady();\r\n      });\r\n    };\r\n\r\n    var layersReady = false;\r\n    var layersReadyQueue = [];\r\n    function onLayersReady(callback) {\r\n      if (layersReady) {\r\n        callback();\r\n      } else {\r\n        layersReadyQueue.push(callback);\r\n      }\r\n    }\r\n\r\n    // main\r\n\r\n    options = options || {};\r\n    options = Object.assign({}, Mapkick.options, options);\r\n    var tooltipOptions = options.tooltips || {};\r\n    var markerOptions = options.markers || {};\r\n    var bounds = new library.LngLatBounds();\r\n\r\n    if (options.replay) {\r\n      fetchData(element, data, options, generateReplayMap);\r\n    } else {\r\n      fetchData(element, data, options, generateMap);\r\n\r\n      if (options.refresh) {\r\n        this.intervalId = setInterval(function () {\r\n          fetchData(element, data, options, updateMap);\r\n        }, options.refresh * 1000);\r\n      }\r\n    }\r\n  };\r\n\r\n  BaseMap.prototype.getMapObject = function getMapObject () {\r\n    return this.map\r\n  };\r\n\r\n  BaseMap.prototype.destroy = function destroy () {\r\n    this.stopRefresh();\r\n\r\n    if (this.map) {\r\n      this.map.remove();\r\n      this.map = null;\r\n    }\r\n  };\r\n\r\n  BaseMap.prototype.stopRefresh = function stopRefresh () {\r\n    if (this.intervalId) {\r\n      clearInterval(this.intervalId);\r\n      this.intervalId = null;\r\n    }\r\n  };\r\n\r\n  var Map = /*@__PURE__*/(function (BaseMap) {\r\n    function Map(element, data, options) {\r\n      BaseMap.call(this, element, data, options, \"point\");\r\n    }\r\n\r\n    if ( BaseMap ) Map.__proto__ = BaseMap;\r\n    Map.prototype = Object.create( BaseMap && BaseMap.prototype );\r\n    Map.prototype.constructor = Map;\r\n\r\n    return Map;\r\n  }(BaseMap));\r\n\r\n  var AreaMap = /*@__PURE__*/(function (BaseMap) {\r\n    function AreaMap(element, data, options) {\r\n      BaseMap.call(this, element, data, options, \"area\");\r\n    }\r\n\r\n    if ( BaseMap ) AreaMap.__proto__ = BaseMap;\r\n    AreaMap.prototype = Object.create( BaseMap && BaseMap.prototype );\r\n    AreaMap.prototype.constructor = AreaMap;\r\n\r\n    return AreaMap;\r\n  }(BaseMap));\r\n\r\n  var Mapkick = {\r\n    Map: Map,\r\n    AreaMap: AreaMap,\r\n    maps: maps,\r\n    options: {},\r\n    library: null\r\n  };\r\n\r\n  Mapkick.use = function (library) {\r\n    Mapkick.library = library;\r\n  };\r\n\r\n  // not ideal, but allows for simpler integration\r\n  if (typeof window !== \"undefined\" && !window.Mapkick) {\r\n    window.Mapkick = Mapkick;\r\n\r\n    // use setTimeout so mapping library can come later in same JS file\r\n    setTimeout(function () {\r\n      window.dispatchEvent(new Event(\"mapkick:load\"));\r\n    }, 0);\r\n  }\r\n\r\n  return Mapkick;\r\n\r\n}));"],"names":["global","factory","exports","module","define","amd","globalThis","self","Mapkick","getElement","element","elementId","document","getElementById","Error","validateColor","color","test","createMarkerImage","library","height","width","scale","svg","Marker","_element","querySelector","removeAttribute","setAttribute","circles","querySelectorAll","circle","length","c","cloneNode","parentNode","insertBefore","image","Image","src","encodeURIComponent","outerHTML","maps","BaseMap","data","options","mapType","this$1$1","window","mapboxgl","maplibregl","map","trails","groupedData","timestamps","timeIndex","id","getJSON","url","success","xhr","XMLHttpRequest","open","setRequestHeader","onload","status","JSON","parse","responseText","showError","statusText","send","onMapLoad","callback","loaded","on","toTimestamp","ts","Date","getTime","generateReplayMap","i","row","time","push","bounds","extend","rowCoordinates","i$1","Object","prototype","hasOwnProperty","call","parseInt","sort","generateMap","setTimeout","nextFrame","updateMap","message","textContent","errorCatcher","err","fetchData","newData","onLayersReady","trail","recordTrails","getSource","setData","generateTrailsGeoJSON","generateGeoJSON","markerIds","Map","geojson","type","features","properties","assign","geometry","icon","defaultIcon","mapkickIconSize","mapkickIconAnchor","mapkickIconOffset","markerOptions","markerId","get","undefined","size","set","coordinates","mapkickColor","longitude","lng","lon","latitude","lat","getTrailId","trailOptions","trailId","len","shift","generateLabelGeoJSON","feature","LngLatBounds","extendBounds","isEmpty","center","getCenter","layerBeforeFill","layers","getStyle","beforeId","layer","metadata","addLayer","name","centersById","addSource","source","layout","paint","property","outlineId","labelName","labelData","hover","tooltipOptions","popupOptions","closeButton","closeOnClick","anchor","popup","Popup","panMap","style","getComputedStyle","matrix","DOMMatrixReadOnly","transform","padding","extra","top","m42","left","m41","panBy","Math","min","showPopup","e","selectedFeature","tooltip","startsWith","offset","setLngLat","html","setHTML","setText","addTo","_container","offsetWidth","getLatitude","selected","currentPoint","point","mapkickPopupOpened","remove","getCanvas","cursor","j","coordinates$1","j$1","polygon","k","isMapLibre","version","zoom","mapOptions","container","dragRotate","touchZoomRotate","projection","accessToken","controls","addControl","NavigationControl","showCompass","stylesheet","getZoom","fitBounds","animate","maxZoom","outstanding","checkReady","layersReady","cb","layersReadyQueue","forEach","addEventListener","addImage","tooltips","markers","replay","refresh","intervalId","setInterval","getMapObject","destroy","stopRefresh","clearInterval","__proto__","create","constructor","AreaMap","use","dispatchEvent","Event"],"version":3,"file":"index.40805586.js.map","sourceRoot":"/__parcel_source_root/"}